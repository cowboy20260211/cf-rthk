# 香港电台CF版项目开发计划

## 一、项目概述
- **项目名称**：香港电台CF版（Radio CF）
- **项目目标**：打造一个适配多平台的香港电台在线收听与节目点播平台
- **技术架构**：Cloudflare Workers + 现代前端框架
- **项目周期**：预计4-6周

---

## 二、功能需求清单

### 2.1 核心功能
| 功能模块 | 优先级 | 描述 |
|----------|--------|------|
| 直播收听 | P0 | 第一台、第二台、第五台直播流播放 |
| 节目重温 | P0 | 各台节目列表、时间轴选择播放 |
| 节目收藏 | P1 | 收藏节目、快速访问、历史记录 |
| 页面适配 | P1 | 电脑端、手机端、微信小程序 |
| 自动部署 | P1 | Cloudflare Workers自动化部署 |

### 2.2 详细功能说明
#### 直播功能
- 获取rthk.hk第一台、第二台、第五台直播链接
- 复现rthk.hk网站的播放器样式
- 直播流稳定性优化
- 播放状态记忆（切出后返回保持播放）

#### 节目重温功能
- 自动获取各台节目重温列表
- 节目分类与搜索功能
- 时间轴选择器（可视化展示可播放时段）
- 播放历史记录
- 断点续播功能

#### 收藏功能
- 收藏喜欢的节目
- 收藏夹管理（新建/编辑/删除）
- 收藏快速访问入口
- 收藏同步（LocalStorage + 可选云端同步）

#### 页面适配
- **电脑端**：完整功能布局，播放器固定底部
- **手机端**：移动优先设计，响应式布局
- **微信小程序**：适配小程序规范，API对接

---

## 三、技术架构设计

### 3.1 前端架构
```
├── src/
│   ├── components/       # 可复用组件
│   │   ├── Player/       # 播放器组件
│   │   ├── Live/         # 直播组件
│   │   ├── Program/      # 节目组件
│   │   ├── Favorite/     # 收藏组件
│   │   └── Common/       # 通用组件
│   ├── pages/            # 页面
│   │   ├── index/        # 首页
│   │   ├── live/         # 直播页面
│   │   ├── programs/     # 节目页面
│   │   ├── favorites/    # 收藏页面
│   │   └── profile/      # 个人中心
│   ├── services/         # API服务
│   ├── stores/           # 状态管理
│   ├── utils/            # 工具函数
│   └── styles/           # 样式文件
```

### 3.2 技术选型
- **框架**：React / Vue 3（根据团队技术栈选择）
- **构建工具**：Vite
- **状态管理**：Pinia / Zustand
- **样式方案**：Tailwind CSS / CSS Modules
- **音频播放**：Howler.js / 原生Audio API
- **数据请求**：Axios / Fetch
- **路由管理**：React Router / Vue Router

### 3.3 Cloudflare Workers架构
```
workers/
├── src/
│   ├── index.ts          # 入口文件
│   ├── routes/           # 路由处理
│   │   ├── live.ts       # 直播流代理
│   │   ├── programs.ts   # 节目数据获取
│   │   └── api.ts        # 通用API
│   ├── services/         # 服务层
│   │   ├── rthk.ts       # rthk.hk数据获取
│   │   ├── cache.ts      # 缓存服务
│   │   └── parser.ts     # 数据解析
│   ├── types/            # 类型定义
│   └── utils/            # 工具函数
├── wrangler.toml         # Cloudflare配置
└── package.json
```

### 3.4 数据存储方案
- **KV存储**：用户收藏数据、播放历史
- **R2存储**：静态资源（可选）
- **LocalStorage**：本地数据持久化

---

## 四、第三方服务配置

### 4.1 Cloudflare Workers
- **账号**：2026012701@cowboy.cc.cd
- **密码**：cowboy@61862
- **部署方式**：Wrangler CLI自动部署
- **域名配置**：自定义域名或Cloudflare子域名

### 4.2 GitHub
- **账号**：2026012701@cowboy.cc.cd
- **密码**：Cowboy61862
- **仓库策略**：
  - main分支：生产版本
  - dev分支：开发版本
  - feature分支：功能开发
- **自动部署**：GitHub Actions触发Workers部署

---

## 五、开发阶段规划

### 阶段一：基础架构搭建（1周）
**目标**：完成项目初始化与基础架构

**任务清单**：
- [ ] 项目脚手架搭建（React/Vue + Vite）
- [ ] 目录结构规划与配置
- [ ] ESLint/Prettier/Husky配置
- [ ] Cloudflare Workers项目初始化
- [ ] Wrangler配置与本地调试环境
- [ ] Git仓库初始化与分支策略
- [ ] CI/CD流程配置（GitHub Actions）
- [ ] 基础UI组件库搭建
- [ ] 主题系统与样式架构

**交付物**：
- 可运行的空项目框架
- 完整的开发/构建/部署流程
- 文档化的架构设计

### 阶段二：核心功能开发（2周）
**目标**：完成直播与节目重温功能

**任务清单**：
- [ ] rthk.hk网站结构分析
- [ ] 直播链接获取与解析
- [ ] 直播播放器开发（复现原站样式）
- [ ] 直播流稳定性优化
- [ ] 节目列表数据获取
- [ ] 节目详情页面开发
- [ ] 时间轴选择器组件
- [ ] 节目播放功能实现
- [ ] 播放状态管理
- [ ] 错误处理与重试机制

**交付物**：
- 完整的直播功能
- 可用的节目重温功能
- 播放器交互优化

### 阶段三：用户功能开发（1周）
**目标**：完成收藏与个性化功能

**任务清单**：
- [ ] 用户收藏数据模型设计
- [ ] 收藏夹CRUD功能
- [ ] 收藏快速播放功能
- [ ] 播放历史记录
- [ ] 断点续播功能
- [ ] 用户偏好设置
- [ ] LocalStorage数据同步
- [ ] 数据导出/导入功能

**交付物**：
- 完整的收藏系统
- 个性化播放体验

### 阶段四：多端适配（1周）
**目标**：完成电脑、手机、小程序适配

**任务清单**：
- [ ] 响应式布局适配
- [ ] 电脑端UI优化
- [ ] 手机端UI优化
- [ ] 微信小程序适配
- [ ] 小程序API对接
- [ ] 分享功能开发
- [ ] 性能优化
- [ ] 跨端测试

**交付物**：
- 三端可用的产品
- 性能测试报告

### 阶段五：测试与优化（1周）
**目标**：确保产品质量

**任务清单**：
- [ ] 功能测试（单元测试+集成测试）
- [ ] 性能测试与优化
- [ ] 兼容性测试
- [ ] 安全漏洞扫描
- [ ] 用户体验优化
- [ ] 文档完善
- [ ] 部署流程验证
- [ ] 上线准备

**交付物**：
- 测试报告
- 优化后的产品
- 完整文档

---

## 六、关键页面设计

### 6.1 首页
```
┌─────────────────────────────┐
│  Logo + 标题                │
├─────────────────────────────┤
│  🎙️ 直播入口                │
│  ├─ 第一台                  │
│  ├─ 第二台                  │
│  └─ 第五台                  │
├─────────────────────────────┤
│  📻 热门节目                │
│  [节目卡片×4]               │
├─────────────────────────────┤
│  ⭐ 我的收藏                │
│  [收藏卡片×2]               │
├─────────────────────────────┤
│  📱 底部导航栏              │
└─────────────────────────────┘
```

### 6.2 直播页面
```
┌─────────────────────────────┐
│  ← 返回                    │ 港台第一台
├─────────────────────────────┤
│                             │
│       [播放器区域]          │
│       复现rthk播放器        │
│                             │
├─────────────────────────────┤
│  当前节目名称               │
│  节目简介...                │
├─────────────────────────────┤
│  🔗 节目重温入口            │
└─────────────────────────────┘
```

### 6.3 节目列表页面
```
┌─────────────────────────────┐
│  🔍 搜索框          📅 日期 │
├─────────────────────────────┤
│  [日期选择器]               │
├─────────────────────────────┤
│  📋 节目列表                │
│  ├─ 节目A  10:00-11:00  ⭐ │
│  ├─ 节目B  11:00-12:00  ⭐ │
│  └─ 节目C  12:00-13:00     │
├─────────────────────────────┤
│  加载更多                   │
└─────────────────────────────┘
```

### 6.4 节目详情/播放页面
```
┌─────────────────────────────┐
│  ← 返回            ❤️ 收藏  │
│  节目名称                    │
├─────────────────────────────┤
│  ━━━━●━━━━━━━●━━━━━━●━━     │
│  00:00    15:00    30:00    │
│  [时间轴选择器]              │
├─────────────────────────────┤
│  ▶️ 播放按钮   ⏸️ 暂停       │
│  🔊 音量       ⏩ 快进       │
├─────────────────────────────┤
│  📝 节目简介                │
└─────────────────────────────┘
```

### 6.5 收藏页面
```
┌─────────────────────────────┤
│  收藏夹            + 新建   │
├─────────────────────────────┤
│  📁 所有收藏                 │
│  ├─ 节目列表（可播放）       │
│  └─ 时间点标记               │
├─────────────────────────────┤
│  📱 底部导航栏              │
└─────────────────────────────┘
```

---

## 七、API接口设计

### 7.1 直播相关
| 接口 | 方法 | 描述 |
|------|------|------|
| /api/live | GET | 获取直播列表 |
| /api/live/:id | GET | 获取单个直播详情 |
| /api/live/:id/stream | GET | 获取直播流地址 |

### 7.2 节目相关
| 接口 | 方法 | 描述 |
|------|------|------|
| /api/programs | GET | 获取节目列表 |
| /api/programs/:id | GET | 获取节目详情 |
| /api/programs/:id/episodes | GET | 获取节目分集 |
| /api/episodes/:id | GET | 获取单集详情 |

### 7.3 用户相关
| 接口 | 方法 | 描述 |
|------|------|------|
| /api/favorites | GET | 获取收藏列表 |
| /api/favorites | POST | 添加收藏 |
| /api/favorites/:id | DELETE | 删除收藏 |
| /api/history | GET | 获取播放历史 |
| /api/history | POST | 添加播放记录 |

---

## 八、数据获取方案

### 8.1 rthk.hk网站分析
- **目标页面**：
  - 直播页面：https://www.rthk.hk/radio/radio1 (第一台)
  - 节目页面：https://www.rthk.hk/radio/radio1/programme (节目列表)
  - 重温页面：https://www.rthk.hk/radio/radio1/archive (节目归档)

- **数据获取方式**：
  - HTML解析获取节目列表
  - 音频链接提取
  - JSON数据接口发现
  - 页面结构分析

### 8.2 反爬策略应对
- User-Agent轮换
- 请求频率控制
- 缓存机制
- 代理支持

---

## 九、播放器复现方案

### 9.1 rthk播放器样式分析
- 布局结构
- 配色方案
- 控件样式
- 交互效果
- 动画效果

### 9.2 功能复现
- 播放/暂停
- 进度控制
- 音量控制
- 全屏播放
- 倍速播放
- 播放列表
- 进度条预览

---

## 十、项目里程碑

| 里程碑 | 时间点 | 交付物 |
|--------|--------|--------|
| M1 架构完成 | 第1周末 | 项目框架、CI/CD流程 |
| M2 核心功能 | 第3周末 | 直播+节目功能 |
| M3 用户功能 | 第4周末 | 收藏+历史功能 |
| M4 多端适配 | 第5周末 | 三端可用产品 |
| M5 测试完成 | 第6周末 | 正式上线版本 |

---

## 十一、风险评估与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| rthk.hk网站结构变更 | 中 | 高 | 封装数据获取层、定期监控 |
| 直播流不稳定 | 高 | 中 | 多源备份、降级策略 |
| Cloudflare Workers限制 | 低 | 高 | 监控配额、缓存策略 |
| 小程序审核问题 | 中 | 中 | 提前咨询规范、准备资质 |
| 性能不达标 | 中 | 中 | 性能优化、懒加载 |

---

## 十二、验收标准

### 12.1 功能验收
- 直播播放流畅，无明显卡顿
- 节目列表完整展示
- 时间轴选择直观易用
- 收藏功能稳定可靠
- 三端界面正常显示

### 12.2 性能验收
- 首屏加载 < 3秒
- 播放器启动 < 2秒
- API响应 < 500ms
- 内存占用合理

### 12.3 质量验收
- 无严重Bug
- 无安全漏洞
- 代码规范检查通过
- 单元测试覆盖率 ≥ 80%

---

## 十三、资源需求

### 13.1 人力资源
- 前端开发：1-2人
- 后端/Workers开发：1人
- 测试：0.5人

### 13.2 技术资源
- Cloudflare Workers Free/Pro计划
- GitHub私有仓库
- 开发工具与IDE

---

## 十四、后续迭代规划

### v1.1 功能增强
- [ ] 更多电台接入
- [ ] 节目预约提醒
- [ ] 社交分享功能
- [ ] 用户评论系统

### v1.2 体验优化
- [ ] PWA支持
- [ ] 离线播放
- [ ] 音效增强
- [ ] 主题皮肤

### v2.0 平台扩展
- [ ] iOS/Android App
- [ ] 智能音箱支持
- [ ] 车载系统适配
- [ ] 音频节目UGC平台

---

## 附录

### A. 参考资料
- [Cloudflare Workers文档](https://developers.cloudflare.com/workers/)
- [rthk.hk网站](https://www.rthk.hk/)
- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)

### B. 术语说明
- **CF**：Cloudflare的缩写
- **直播**：实时音频流播放
- **重温**：节目点播回听功能
- **Workers**：Cloudflare的无服务器计算平台

---

**文档版本**：v1.0
**创建日期**：2026-02-09
**最后更新**：2026-02-09
